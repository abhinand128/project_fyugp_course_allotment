{% extends 'admin_base.html' %}
{% load custom_filters %}
{% block title %}Manage Courses{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-0.1">
    <h1 class="mb-0"></h1>

    <!-- Current Page & Home Link -->
    <div>
        <span class="me-3 text-muted">Manage Courses | </span>
        <a href="{% url 'admin_dashboard' %}">
            <i class="fas fa-home"></i> Home
        </a>
    </div>
</div>

<div class="container-fluid p-3">

    <!-- Title and Add Button -->
    <div class="d-flex justify-content-between align-items-center mb-2">
        <h1 class="fw-bold">Course Lists</h1>
        <a href="{% url 'add_course' %}" class="btn btn-success me-2">
            <i class="lni lni-graduation"></i><sup>+</sup> Add Course
        </a>
    </div>

    <!-- Django Messages -->
    {% if messages %}
        {% for message in messages %}
        <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
    {% endif %}

    <!-- Search and Filters -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div class="input-group w-50 me-2">
            <input type="text" id="searchBox" class="form-control" placeholder="Search by Course Name, Code..." onkeyup="filterTable()">
            <span class="input-group-text"><i class="fas fa-search"></i></span>
        </div>

        <div class="d-flex">
            <select class="form-select me-2" id="courseTypeFilter" onchange="filterTable()">
                <option value="">All Course Types</option>
                {% for type in course_types %}
                    <option value="{{ type }}">{{ type }}</option>
                {% endfor %}
            </select>

            <select class="form-select me-2" id="departmentFilter" onchange="filterTable()">
                <option value="">All Departments</option>
                {% for department in departments %}
                    <option value="{{ department }}">{{ department }}</option>
                {% endfor %}
            </select>

            <select class="form-select" id="semesterFilter" onchange="filterTable()">
                <option value="">All Semesters</option>
                {% for sem in semesters %}
                    <option value="{{ sem }}">{{ sem }}</option>
                {% endfor %}
            </select>
        </div>
    </div>

    <!-- Courses Table -->
    <div class="card shadow-sm border-0 rounded-3 p-3">
        <div class="table-responsive">
            <table class="table table-bordered table-hover mt-2" id="courseTable">
                <thead class="table-dark">
                    <tr>
                        <th>No.</th>
                        <th>Course Code</th>
                        <th>Course Name</th>
                        <th>Type</th>
                        <th>Department</th>
                        <th>Semester</th>
                        <th class="text-nowrap">Seat Limit</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for course in courses %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ course.course_code }}</td>
                        <td>{{ course.course_name }}</td>
                        <td>{{ course.course_type }}</td>
                        <td>{{ course.department }}</td>
                        <td>{{ course.semester }}</td>
                        <td class="text-nowrap">{{ course.seat_limit }}</td>
                        <td>
                            <div class="d-flex justify-content-around">
                                <a href="{% url 'edit_course' course.id %}" class="btn btn-primary btn-sm me-2">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <a href="{% url 'delete_course' course.id %}" 
                                   class="btn btn-danger btn-sm" 
                                   onclick="return confirm('Are you sure you want to delete this course?');">
                                    <i class="fas fa-trash-alt"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="8" class="text-center">No courses available.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- JavaScript for Dynamic Filtering -->
<script>
function filterTable() {
    let input = document.getElementById("searchBox").value.toUpperCase();
    let courseTypeFilter = document.getElementById("courseTypeFilter").value.toUpperCase();
    let departmentFilter = document.getElementById("departmentFilter").value.toUpperCase();
    let semesterFilter = document.getElementById("semesterFilter").value.toUpperCase();

    let table = document.getElementById("courseTable");
    let rows = table.getElementsByTagName("tr");

    for (let i = 1; i < rows.length; i++) {
        let cells = rows[i].getElementsByTagName("td");
        let courseCode = cells[1]?.innerText.toUpperCase();
        let courseName = cells[2]?.innerText.toUpperCase();
        let courseType = cells[3]?.innerText.toUpperCase();
        let department = cells[4]?.innerText.toUpperCase();
        let semester = cells[5]?.innerText.toUpperCase();

        if (
            (courseCode.includes(input) || courseName.includes(input)) &&
            (courseTypeFilter === "" || courseType === courseTypeFilter) &&
            (departmentFilter === "" || department === departmentFilter) &&
            (semesterFilter === "" || semester === semesterFilter)
        ) {
            rows[i].style.display = "";
        } else {
            rows[i].style.display = "none";
        }
    }
}
</script>
{% endblock %}


